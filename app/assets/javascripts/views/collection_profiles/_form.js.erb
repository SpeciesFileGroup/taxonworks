/*

   Code behind collection_profile attributes updating in /edit and /new

 */

var TW = TW || {};
TW.views = TW.views || {};
TW.views.collection_profiles = TW.views.collection_profiles || {};
TW.views.collection_profiles.form = TW.views.collection_profiles.form || {};

Object.assign(TW.views.collection_profiles.form, {
  update_collection_type_attributes: function() {
    const selected = document.querySelector('input[name="collection_profile[collection_type]"]:checked');
    if (!selected) return;

    const t = selected.value;

    fetch("/collection_profiles/swap_form_attribute_types/" + t)
      .then(response => response.text())
      .then(data => {
        const container = document.getElementById("collection_profile_typed_attributes");
        if (container) container.innerHTML = data;
      });
  },

  initialize_selector: function() {
    const options = document.querySelectorAll('.collection_type_option');
    options.forEach(option => {
      option.addEventListener('change', this.update_collection_type_attributes);
    });
  }
});

document.addEventListener('turbolinks:load', function() {
  if (document.getElementById('collection_profile_typed_attributes')) {
    TW.views.collection_profiles.form.initialize_selector();
  }
});


